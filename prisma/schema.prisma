generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SenderType {
  USER
  AGENT
  BOT
}

model Conversation {
  id                     String    @id @default(uuid())
  chatwootConversationId String    @unique
  unreadCount            Int       @default(0)
  status                 String?
  contactId              String?
  contact                Contact?  @relation(fields: [contactId], references: [id])
  lastMessageAt          DateTime?
  messages               Message[]
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
}

model Contact {
  id                String         @id @default(uuid())
  chatwootContactId String         @unique
  name              String
  email             String?
  avatar            String?
  conversations     Conversation[] // Prisma consegue inferir a relação
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
}

model Message {
  id                String       @id @default(uuid())
  chatwootMessageId String       @unique
  content           String
  sender            SenderType
  isRead            Boolean      @default(false)
  conversationId    String
  conversation      Conversation @relation(fields: [conversationId], references: [id])
  createdAt         DateTime     @default(now())
}
